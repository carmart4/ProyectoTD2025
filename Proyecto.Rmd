---
title: "Análisis de Tickets de Supermercado: Mini Proyecto 2025"
author: |
  <center>
  Ferrer Font, Neus<br>
  Navarro García, Marta<br>
  Rodríguez Simón, Alba<br>
  Aissa Djellouli, Mohammed<br>
  Balbastre Aparisi, Héctor<br>
  Ruiz Ripoll, Joan<br>
  Martinez Torres, Carlos Santiago
  </center>
date: "`r Sys.Date()`"
output:
  html_document:
    echo: true
    number_sections: true
    theme: lumen
    toc: true
  bookdown::pdf_document2:
    toc: true
    toc_depth: 3
    number_sections: true
    figure_caption: "Figura" # Referencias en castellano
    table_caption: "Tabla"
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
  html_notebook:
    echo: true
    number_sections: true
    toc: true
  pdf_document: default
  bookdown::html_document2:
    echo: true
    number_sections: true
    theme: spacelab
    toc: true
    figure_caption: "Figura"
    table_caption: "Tabla"
always_allow_html: true
params:
  lang: ES
lang: "`r switch(params$lang, ES = 'es-ES', EN = 'en-US')`"
subtitle: "Tratamiento de datos. Grado en Ciencia de Datos - UV"
language:
  label:
    fig: 'Figura '
    tab: 'Tabla '
    eq: 'Ecuación '
    thm: 'Teorema '
    lem: 'Lema '
    def: 'Definición '
    cor: 'Corolario '
    prp: 'Proposición '
    exm: 'Ejemplo '
    exr: 'Ejercicio '
    proof: 'Demostración. '
    remark: 'Nota: '
    solution: 'Solución. '
---
Instalación de las librerias.
```{r}
#install.packages("pdftools")
```
Importacion de las librerias. 
```{r, warning=FALSE}
library(pdftools)
library(dplyr)
library(stringr)
```

Lectura de un solo fichero pdf, de prueba. 
```{r}
n_pdf <- 'data/20240323 Mercadona 234,20.pdf'

t_pdf <- pdf_text(n_pdf)
t_pdf

lineas <- strsplit(t_pdf, "\n")[[1]]
grepl('MERCADONA', lineas[1]) # Verificamos que sea una factura de Mercadona. 
```
```{r}
lineas
lineas_limpias <- sub("^\\s+", "", lineas)
lineas_limpias

# Obtenemos información encabezado, FIJO
direccion <- lineas_limpias[2]
direccion

#sub("^\\s+", "", lineas[3])
lineas_limpias[3]
CP <- str_sub(string = lineas_limpias[3], start = 0, end = 5)
CP

str_sub(string = lineas_limpias)

municipio <- str_sub(string = lineas_limpias[3], start = 7)
municipio

lineas_limpias[6]
factura <- str_sub(lineas_limpias[6], -15)
factura

id_tienda <- substr(factura, nchar(factura) - 14, nchar(factura) - 11)
id_tienda

n_caja <- substr(factura, nchar(factura) - 9, nchar(factura) - 7)
n_caja

id_factura <- substr(factura, nchar(factura) - 5, nchar(factura))
id_factura
```




